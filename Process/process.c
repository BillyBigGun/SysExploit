#include <stdio.h>
#include <stdlib.h>

#include <unistd.h>
#include <sys/wait.h>

#include "utils.h"

void exo1(){
    int pid = getpid();
    printf("pid = %d\n", pid);

}

void exo2(){
    int pid = fork();
    if (pid == 0){
        printf("Fils : pid = %d\n", getpid());
    } else {
        wait(NULL);
        printf("Pere : pid = %d\n", getpid());
    }
}

void exo3(){
    int pid = fork();
    if (pid == 0)
    {
        printf("Fils : pid = %d\n", getpid());
        exit(100);

    } 
    else {
        int status;
        int pidFils = wait(&status);
        printf("Pere : pid = %d\n", getpid());
        printf("Pere : exit_value = %d\n", WEXITSTATUS(status));
        printf("Pere : pidFils = %d\n", pidFils);

    }
}

void exo4(){
    int pid = fork();
    if (pid == 0)
    {
        printf("je m'appelle %d et je suis le fils de %d\n", getpid(), getppid());
        

    } 
    else {
        printf("je m'appelle %d et je suis le pere de %d\n", getpid(), pid);
    }
}

void exo5(){
    int pid= fork();
    if(pid == 0){
        sleep(10);
        printf("Fils : pid = %d\n", getpid());
    }
}

void exo6(){
    // Read console input
    int n;
    printf("n = ");
    scanf("%d", &n);

    for(int i = 0; i < n; i++){
        int pid = fork();
        if(pid == 0){
            printf("Fils : n = %d\n", i);
            exit(0);
        }
    }

    for(int i = 0; i < n; i++){
        wait(NULL);
    }
    printf("Pere : pid = %d\n", getpid());
}

void exo7(){
    int pid = fork();
    if(pid == 0){
        sleep(1);
        printf("Fils : pid = %d\n", getpid());
        exit(0);
    }
    else{
        int i = 0;
        while(i++ < 10000000000);
        printf("Pere : pid = %d\n", getpid());
    }
}

void exo8(){
    execl("./process2", "./process2", NULL);
    perror("exec not in path");
}

void exo9(){
    int pid = fork();
    if (pid == 0){
        execl("./process2", "./process2", NULL);
        perror("exec not in path");
    }
    wait(NULL);
    printf("Pere : pid = %d\n", getpid());
}

void exo10(){
    int pid = fork();
    if (pid == 0){
        execl("./process3", "./process3", NULL);
        perror("exec not in path");
    }

    wait(NULL);
    printf("Pere : pid = %d\n", getpid());
}



int main(int argc, char *argv[])
{
    exo10();
    return EXIT_SUCCESS;
}